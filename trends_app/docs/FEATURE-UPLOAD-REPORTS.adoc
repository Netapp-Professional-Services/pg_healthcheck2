Schema and Feature TODO List

This list is based on the analysis of the health_trends database schema. It outlines the major tasks required to implement the recommended features and improvements.
Phase 1: Feature - AsciiDoc Report Uploads

This is the primary feature request. The goal is to allow users to upload their own AsciiDoc reports.

    Database (DB) Task:

        [ ] Create the new uploaded_reports table in the database using the SQL provided in the analysis.

    Backend (Flask) Tasks:

        [ ] Create a new privilege, e.g., UploadReports, to control who can upload reports.

        [ ] Create a new route in a relevant blueprint (e.g., profile.py) to render the upload page. This route should be protected by the UploadReports privilege.

        [ ] Create a new Flask endpoint to handle the POST request from the upload form. This endpoint will:

            Check for the UploadReports privilege.

            Process the uploaded file.

            Read the AsciiDoc content.

            Encrypt the content using pgp_sym_encrypt.

            Insert a new record into the uploaded_reports table.

    Frontend (HTML/Jinja2) Tasks:

        [ ] Create a new HTML template (upload_report.html) with a form that includes fields for file input, report name, and description.

        [ ] Add a link or button to the main application interface (e.g., in report_history.html or the main dashboard) that navigates to the upload page, visible only to users with the UploadReports privilege.

Phase 2: Feature - Report Versioning

This feature builds upon the existing "edit report" functionality to provide a full history of changes.

    Database (DB) Task:

        [ ] Create the new report_versions table in the database.

    Backend (Flask) Tasks:

        [ ] Modify the existing /profile/save-report/<int:report_id> endpoint in profile.py.

        [ ] Change the logic from UPDATE generated_ai_reports to INSERT INTO report_versions. The endpoint will need to determine if the report being edited is from generated_ai_reports or the new uploaded_reports table to link it correctly.

        [ ] Modify the /profile/view-report/<int:report_id> endpoint to fetch the content from the most recent entry in the report_versions table associated with that report.

    Frontend (HTML/Jinja2) Tasks:

        [ ] Add a "Version History" section to the view_report.html page.

        [ ] This section will display a list of all versions from the report_versions table, allowing a user to view or revert to older versions.

Phase 3: Schema Refinements (Optional but Recommended)

These tasks improve the long-term maintainability and clarity of the schema.

    Task: Consolidate User Active Status

        [ ] Add an is_active BOOLEAN NOT NULL DEFAULT true column to the users table.

        [ ] Write a one-time migration script to populate this new column based on the current values in the usrpref table.

        [ ] Update the usercanlogin function in PostgreSQL to check this new is_active column instead of querying usrpref.

        [ ] Update the user management UI (admin/users.html) and backend logic (admin.py) to use this new column for enabling/disabling users.

    Task: Add Foreign Key to usrpref

        [ ] Add a foreign key constraint to the usrpref table: CONSTRAINT fk_usrpref_user FOREIGN KEY (usrpref_username) REFERENCES users(username) ON DELETE CASCADE;. This will ensure that when a user is deleted, all of their associated preferences are automatically removed, preventing orphaned data.
